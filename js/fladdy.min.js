(function(b){var a={toRadian:function(c){return c/180*Math.PI},toAngle:function(c){return c/Math.PI*180},imgload:function(c,f){var e={};var d=0;c.forEach(function(h){var g=new Image();g.src="images/"+h+".png";g.addEventListener("load",function(){d++;e[h]=g;if(d>=c.length){f(e)}})})},};b.Fly=a})(window);(function(c,b){function e(f){this.defaultData={wrapId:"fladdybirds",speed:15};this.init(f)}e.prototype={constructor:e,init:function(g){var i=this;var f=this.defaultData;this.extend(f,g);var h=["birds","land","pipe1","pipe2","sky"];this.createEle();this.bind();this.startgame(h,-(f.speed/100))},createEle:function(){this.wrapper=b.getElementById(this.defaultData.wrapId);this.cv=b.createElement("canvas");this.bg=b.createElement("div");this.info=b.createElement("div");this.numinfo=b.createElement("span");this.second=b.createElement("span");this.second.innerHTML=" 秒";this.numinfowrap=b.createElement("p");this.numinfowrap.innerHTML="总共坚持了 ";this.restart=b.createElement("button");this.restart.innerHTML="重新开始";this.numinfowrap.appendChild(this.numinfo);this.numinfowrap.appendChild(this.second);this.info.appendChild(this.numinfowrap);this.info.appendChild(this.restart);this.bg.appendChild(this.info);this.wrapper.appendChild(this.cv);this.wrapper.appendChild(this.bg);this.ctx=this.cv.getContext("2d");this.cv.height=600;this.cv.width=800;this.wrapper.style.position="relative";this.bg.style.position="absolute";this.bg.style.top=0;this.bg.style.left=0;this.bg.style.width=this.cv.width+"px";this.bg.style.height=this.cv.height+"px";this.bg.style.display="none";this.bg.style.backgroundColor="rgba(0,0,0,.3)";this.info.style.position="absolute";this.info.style.top="180px";this.info.style.left="250px";this.info.style.width="300px";this.info.style.height="140px";this.info.style.textAlign="center";this.info.style.backgroundColor="rgba(255,255,255,.3)";this.numinfowrap.style.font="400 20px/30px 'microsoft yahei'";this.restart.style.width="140px";this.restart.style.height="30px";this.numinfo.style.color="red"},startgame:function(g,f){var h=this;c.imgload(g,function(n){h.imgObj=n;h.speed=f;h.lastTime=+new Date();h.gameTime=0;var j=[];h.isStart=true;h.bird=new c.Bird({ctx:h.ctx,img:n["birds"]});for(var m=0;m<2;m++){var o=new c.Sky({ctx:h.ctx,img:n["sky"],x:n["sky"].width*m,y:0,speed:h.speed});j.push(o)}for(var m=0;m<6;m++){var l=new c.Pipe({cv:h.cv,ctx:h.ctx,pipeTop:n["pipe2"],pipeBot:n["pipe1"],x:n["pipe2"].width*m*3+300,speed:h.speed});j.push(l)}for(var m=0;m<4;m++){var k=new c.Land({cv:h.cv,ctx:h.ctx,img:n["land"],x:n["land"].width*m,y:0,speed:h.speed});j.push(k)}h.draw(j)})},draw:function(f){var h=this;(function g(){var k=+new Date(),l=k-h.lastTime;h.lastTime=k;h.gameTime+=l;h.ctx.save();h.ctx.beginPath();h.ctx.clearRect(0,0,h.cv.width,h.cv.height);for(var j=0;j<f.length;j++){f[j].draw(l)}h.ctx.font="18px 微软雅黑";h.ctx.fillText("已坚持了 ",630,30);h.ctx.save();h.ctx.fillStyle="red";h.ctx.fillText(h.gameTime/1000,710,30,50);h.ctx.restore();h.ctx.fillText(" 秒",760,30);h.ctx.fillText("键盘 ↑ 键控制跳跃，Enter键 控制重新开始",430,560);h.bird.draw(l);if(h.bird.lastY<=10||(h.bird.lastY>=h.cv.height-h.imgObj["land"].height-15)||h.ctx.isPointInPath(h.bird.x,h.bird.lastY)){h.stopganme()}h.ctx.restore();if(h.isStart){window.requestAnimationFrame(g)}})()},bind:function(){var f=this;this.cv.addEventListener("click",function(g){f.bird.changeAngle(-0.3)});this.restart.addEventListener("click",function(){window.location.reload()});b.addEventListener("keydown",function(g){if(g.keyCode===38){f.bird.changeAngle(-0.3)}else{if(g.keyCode===13){window.location.reload()}}})},stopganme:function(){this.isStart=false;this.numinfo.innerHTML=this.gameTime/1000;this.bg.style.display="block"},extend:function(f,h){for(var g in h){f[g]=h[g]}},};var a=null;var d=function(f){if(a===null){a=new e(f)}return a};c.Game=d})(Fly,document);(function(a){function b(c){this.defaultData={};this.init(c)}b.prototype={constructor:b,init:function(d){var e=this;var c=this.defaultData;this.extend(c,d);this.ctx=c.ctx;this.img=c.img;this.imgW=this.img.width/3;this.imgH=this.img.height;this.numX=0;this.V0=0;this.a=0.0005;this.lastY=100;this.x=100;this.S=0;this.maxAngle=45,this.maxSpeed=0.3;this.curAngle=0},draw:function(c){this.V0=this.V0+this.a*c;this.S=this.V0*c+0.5*this.a*Math.pow(c,2);this.lastY+=this.S;this.curAngle=this.V0/this.maxSpeed*this.maxAngle;if(this.V0>=this.maxSpeed){this.curAngle=this.maxAngle}else{if(this.V0<=-this.maxSpeed){this.curAngle=-this.maxAngle}}this.ctx.translate(this.x,this.lastY);this.ctx.rotate(a.toRadian(this.curAngle));this.ctx.drawImage(this.img,this.imgW*this.numX++,0,this.imgW,this.imgH,-this.imgW/2,-this.imgH/2,this.imgW,this.imgH);this.numX%=3},changeAngle:function(c){this.V0=c},extend:function(c,e){for(var d in e){c[d]=e[d]}},};a.Bird=b})(Fly);(function(a){function b(c){this.defaultData={};this.init(c)}b.prototype={constructor:b,init:function(d){var e=this;var c=this.defaultData;this.extend(c,d);this.ctx=c.ctx;this.img=c.img;this.imgW=this.img.width;this.imgH=this.img.height;
this.x=c.x||0;this.y=c.y||0;this.speed=c.speed},draw:function(c){this.ctx.drawImage(this.img,this.x,this.y,this.imgW,this.imgH);this.x+=c*this.speed;if(this.x<=-this.imgW){this.x+=this.imgW*2}},extend:function(c,e){for(var d in e){c[d]=e[d]}},};a.Sky=b})(Fly);(function(a){function b(c){this.defaultData={};this.init(c)}b.prototype={constructor:b,init:function(d){var e=this;var c=this.defaultData;this.extend(c,d);this.cv=c.cv;this.ctx=c.ctx;this.img=c.img;this.imgW=this.img.width;this.imgH=this.img.height;this.x=c.x||0;this.y=c.y||this.cv.height-this.img.height;this.speed=c.speed},draw:function(c){this.ctx.drawImage(this.img,this.x,this.y,this.imgW,this.imgH);this.x+=c*this.speed;if(this.x<=-this.imgW){this.x+=this.imgW*4}},extend:function(c,e){for(var d in e){c[d]=e[d]}},};a.Land=b})(Fly);(function(b){function a(c){this.defaultData={};this.init(c)}a.prototype={constructor:a,init:function(d){var e=this;var c=this.defaultData;this.extend(c,d);this.cv=c.cv;this.ctx=c.ctx;this.pipeTop=c.pipeTop;this.pipeBot=c.pipeBot;this.imgW=this.pipeTop.width;this.imgH=this.pipeTop.height;this.speed=c.speed;this.x=c.x;this.pipeTopy=0;this.pipeBoty=0;this.hardlevel=130;this.creatY()},creatY:function(){var c=Math.random()*200+50;this.pipeTopy=c-this.imgH;this.pipeBoty=c+this.hardlevel},draw:function(c){this.ctx.drawImage(this.pipeTop,this.x,this.pipeTopy,this.imgW,this.imgH);this.ctx.drawImage(this.pipeBot,this.x,this.pipeBoty,this.imgW,this.imgH);this.ctx.rect(this.x-5,this.pipeTopy-5,this.imgW+10,this.imgH+10);this.ctx.rect(this.x-5,this.pipeBoty-5,this.imgW+10,this.imgH+10);this.x+=c*this.speed;if(this.x<=-this.imgW){this.x+=this.imgW*6*3}},extend:function(c,e){for(var d in e){c[d]=e[d]}},};b.Pipe=a})(Fly);